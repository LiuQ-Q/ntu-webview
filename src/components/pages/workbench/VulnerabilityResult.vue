<template>
  <b-container>
    <div class="mb-5">
      <h1>漏洞扫描结果</h1>
    </div>

    <b-table
      :fields="[
        { key: 'mark', label: '标识' },
        { key: 'library_name', label: '组件' },
        { key: 'module_name', label: '模组' },
        { key: 'library_version', label: '版本' },
        { key: 'issue_type', label: '问题类型' },
        { key: 'source_type', label: '问题来源' },
        { key: 'score', label: '综合打分' },
        { key: 'detail', label: '详情' },
        { key: 'check', label: '选择' },
      ]"
      :items="scansIssues"
      class="text-center"
    >
      <template slot="thead-top">
        <tr>
          <th>
            <h5>问题列表</h5>
          </th>
          <th colspan="6">&nbsp;</th>
          <th>
            <b-dropdown 
              text="操作" 
              :disabled="vulChecked.length === 0 ? true : false"
            >
              <b-dropdown-item>压制</b-dropdown-item>
              <b-dropdown-item>解除压制</b-dropdown-item>
            </b-dropdown>
          </th>
          <th>
            <b-dropdown text="下载">
              <b-dropdown-item>JSON</b-dropdown-item>
              <b-dropdown-item>PDF</b-dropdown-item>
              <b-dropdown-item>XML</b-dropdown-item>
              <b-dropdown-item>CSV</b-dropdown-item>
            </b-dropdown>
          </th>
        </tr>  
      </template>

      <template 
        slot="mark" 
        slot-scope="data"
      >{{ data.item['security_issue']['public_id'] }}</template>

      <template 
        slot="score" 
        slot-scope="data"
      >{{ data.item['security_issue'].score }}</template>

      <template 
        slot="detail"
        slot-scope="data"
      >
        <b-link :to="`${scanId}/issue/${data.item.id}`">查看</b-link>
      </template>

      <template slot="check" slot-scope="data">
        <b-checkbox 
          v-model="vulChecked"
          :value="data.item.id"
        ></b-checkbox>
      </template>
    </b-table>
  </b-container>
</template>

<script>
export default {
  data() {
    return {
      vulChecked: [],
      vulnerabilityResult: [
        {
          mark: 'CVE-2018-1111',
          library: 'ffmpeg',
          module: '0.elf',
          version: '1.1.1',
          style: 'CVE',
          source: '二进制',
          score: '8.8',
        },
        {
          mark: 'CVE-2018-2222',
          library: 'ffmpeg',
          module: '0.elf',
          version: '1.1.1',
          style: 'CVE',
          source: '二进制',
          score: '8.8',
        },
        {
          mark: 'CVE-2018-3333',
          library: 'ffmpeg',
          module: '0.elf',
          version: '1.1.1',
          style: 'CVE',
          source: '二进制',
          score: '8.8',
        },
      ],

      orgId: this.$route.params.orgId,
      projectId: this.$route.params.projectId,
      scanId: this.$route.params.scanId,
      scansIssues: []
    }
  },
  mounted() {
    this.getScansIssues();
  },
  methods: {
    async getScansIssues() {
      this.scansIssues = (await this.$backend.scans.issues.getList(this.scanId)).results;
      console.log(this.scansIssues);
      
    }
  }
}
</script>

<style>

</style>
